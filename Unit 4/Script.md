# Module 4: CRUD Operations in MongoDB


## Table of Contents
1. Creating new documents
2. Retrieving and finding documents
3. Sorting and limiting data in query results
4. Working with nested documents and arrays
5. Updating documents using UPDATE operators
6. Deleting documents from a collection
7. Assessment



- Slide 1 - 
Welcome back! As we continue our exploration of MongoDB, we now embark on Module 4.

- Slide 2 Objectives - 

In this module, we delve into various essential operations, focusing on working with documents within collections. We will cover the process of creating new documents and explore different techniques for retrieving and finding specific documents based on criteria. Sorting and limiting data in query results will be discussed to enhance result presentation. We will also explore working with nested documents and arrays, enabling the storage of complex and structured data. Updating documents using MongoDB's powerful UPDATE operators will be demonstrated, allowing efficient modifications to existing data. Finally, we will explore the deletion of documents from a collection, ensuring effective data management. Through these topics, you will gain a comprehensive understanding of document-centric operations and their application in MongoDB.


- Slide 3 - 


The process of inserting new documents into collections involves utilizing the `insertOne()` and `insertMany()` methods, which offer flexibility depending on the number of documents to be inserted. 

To insert a single document, you can use the `insertOne()` method. This method takes a single document as an argument and adds it to the specified collection. For example,`db.collectionName.insertOne({ field1: value1, field2: value2, ... });`. 

On the other hand, when you need to insert multiple documents simultaneously, you can employ the `insertMany()` method. This method takes an array of documents as the parameter, and each document is inserted into the specified collection. For example, `db.collectionName.insertMany([{ field1: value1, field2: value2 }, { field1: value3, field2: value4 }, ... ]);`. 

Both `insertOne()` and `insertMany()` methods return information about the inserted documents, including the _id field, which is automatically generated by MongoDB to provide a unique identifier for each document. By utilizing these methods, you can seamlessly insert new documents into MongoDB collections, ensuring efficient data storage and organization.


- Slide 4  - 


When working with MongoDB, the find() and findOne() methods, along with query operators, provide powerful capabilities to filter and search for precise data.

The find() method is commonly used for basic querying. By calling find() without any parameters, you can retrieve all documents from a collection, fetching every document present in the collection.

On the other hand, the findOne() method is particularly useful when you need to retrieve a single document from a collection that matches a specific filter. It returns the first document that satisfies the query criteria, making it efficient for quickly accessing a specific record.

By leveraging the find() and findOne() methods, along with query operators, MongoDB enables flexible and precise data retrieval, empowering us developers to efficiently work with collections and obtain the desired results.



- Slide 5 _


Comparison operators play a crucial role in querying based on specific conditions. MongoDB offers a range of useful comparison operators that allow for precise data retrieval. Some commonly utilized comparison operators include `$eq` for equality, `$ne` for not equals, `$gt` for greater than, `$lt` for less than, `$gte` for greater than or equals, and `$lte` for less than or equals. To illustrate, suppose you want to find documents where the "age" field exceeds 30. In this case, you can execute the following query: `db.collectionName.find({ age: { $gt: 30 } })`. This query will return all the documents that satisfy the condition of having an "age" value greater than 30. By leveraging these comparison operators, MongoDB enables precise and flexible querying based on specific conditions.


- Slide 6 -

MongoDB offers powerful logical operators as well. These operators facilitate combining multiple conditions in a single query, and including `$and`, `$or`, and `$not`, which expand the querying capabilities by allowing for complex conditions. To illustrate, suppose you wish to find documents where the "age" field is greater than 30 and the "gender" field is "male". In such cases, you can employ the `$and` operator within the `find()` method. The query would look like this: `db.collectionName.find({ $and: [{ age: { $gt: 30 } }, { gender: "male" }] })`. This query will fetch all the documents that satisfy both conditions simultaneously. MongoDB's logical operators empower users to construct sophisticated queries by combining multiple conditions to retrieve the desired documents.

- Slide 7 -

Array operators offer valuable functionality for querying arrays within documents. These operators, such as `$in`, `$nin`, `$all`, `$elemMatch`, and others, enable precise querying and manipulation of array fields. Where the `$in` operator matches arrays that contain all elements specified, the `$nin` selects documents where the field does not match any value specified, the `$all` selects document where the field contains all the specified elements , and the `$elemMatch` matches documents with an array field which contains at least one element of the specified criteria. For instance, suppose you want to find documents where the "tags" field contains either "mongodb" or "database". In this case, you can utilize the `$in` operator within the `find()` method. The query would be as follows: `db.collectionName.find({ tags: { $in: ["mongodb", "database"] } })`. This query will retrieve all the documents where the "tags" field includes either "mongodb" or "database". By employing array operators, MongoDB provides a versatile solution for querying and working with arrays in documents, allowing for efficient data retrieval and manipulation.

- Slide 8 - 

Projections provide a way to control the fields that are returned in the query results. By default, the `find()` method returns all fields of the matched documents. However, you can tailor the output by specifying which fields to include or exclude using the second parameter of the `find()` method. If you want to retrieve only the "name" and "age" fields in the result, you can execute the query: `db.collectionName.find({}, { name: 1, age: 1 })`. This query will include only the specified fields ("name" and "age") in the returned documents. The value of 1 indicates inclusion, while 0 would signify exclusion. Projections offer a flexible way to fine-tune the query output by selecting the necessary fields and reducing the amount of data transferred, optimizing efficiency in data retrieval.

By using these querying techniques and operators, you can effectively filter and search for specific data in MongoDB collections, retrieving the desired documents based on your criteria.

- Slide 9 -
To sort query results based on specific fields and limit the number of returned documents, you can utilize the `sort()` and `limit()` methods. After executing a query using the `find()` method, you can chain the `sort()` method to apply sorting based on a specific field. By passing a sorting criteria object to the `sort()` method, you can specify the field and the sorting order, with `1` for ascending order and `-1` for descending order. For example, to sort documents in ascending order based on the "age" field, you would use the syntax `db.collectionName.find().sort({ age: 1 })`.

Additionally, you can limit the number of returned documents using the `limit()` method. By chaining it after the `find()` method, you can specify the maximum number of documents to be returned. For example, you would use the syntax `db.collectionName.find().limit(5)` to retrieve only the first five documents.

You can combine the sorting and limiting operations to further refine your results. This allows you to retrieve a specific number of documents in sorted order. For example, to retrieve the five oldest documents based on the "age" field, you would use the syntax `db.collectionName.find().sort({ age: -1 }).limit(5)`.

By incorporating the `sort()` and `limit()` methods into your queries, you gain control over the order and number of returned documents, enabling efficient data retrieval and analysis.

- Slide 10 

We have available to us some powerful techniques for accessing and manipulating nested documents and arrays within documents, offering flexibility and efficiency in working with complex data structures. Dot notation is used to access fields within nested documents, allowing you to navigate through the hierarchy by chaining field names. This enables you to access deeply nested fields, such as `documentName.address.location.coordinates`, which retrieves the "coordinates" field within the "location" field, nested within the "address" field.

Manipulating nested documents involves using dot notation and operators like `$set` and `$unset`. By specifying the field path and the desired update, you can modify fields within nested documents. For example, `db.collectionName.updateOne({ _id: ObjectId("documentId") }, { $set: { "address.city": "New City" } })` updates the "city" field within the "address" field of a specific document.

Accessing and manipulating arrays in MongoDB is straightforward using the array index, allowing you to retrieve specific elements. Additionally, MongoDB provides an array of operators like `$push`, `$pop`, `$addToSet`, and `$pull` to efficiently modify array elements.

The flexibility of MongoDB extends to combining nested documents and arrays within documents. This enables the representation of complex data structures, where you can access and manipulate nested documents within arrays and arrays within nested documents using the techniques mentioned above.




- Slide 11 - 


MongoDB provides a wide range of powerful update operators that enable efficient modification of existing documents in collections. These operators offer flexibility and precision when it comes to updating and manipulating data.

The $set operator is particularly useful for updating specific fields within a document or adding new fields if they don't already exist. For example, `db.collectionName.updateOne({ _id: ObjectId("documentId") }, { $set: { field1: value1, field2: value2 } })` updates the "field1" and "field2" fields within a specific document.

On the other hand, the $unset operator allows you to remove specified fields from a document, effectively deleting them. For instance, `db.collectionName.updateOne({ _id: ObjectId("documentId") }, { $unset: { field1: "" } })` removes the "field1" field from a specific document.

The $inc operator is particularly handy for numeric fields, as it enables you to increment or decrement their values by a specified amount. For example, `db.collectionName.updateOne({ _id: ObjectId("documentId") }, { $inc: { field1: 1 } })` increments the value of the "field1" field by 1 in a specific document.



- Slide 12 -

When working with array fields, the `$push` operator comes in handy by allowing you to append elements to the existing array. For example, `db.collectionName.updateOne({ _id: ObjectId("documentId") }, { $push: { arrayField: element } })` adds an "element" to the "arrayField" within a specific document.

Lastly, the `$pull` operator allows you to remove specific elements from an array field based on a specified condition. For example, `db.collectionName.updateOne({ _id: ObjectId("documentId") }, { $pull: { arrayField: { condition } } })` removes elements from the "arrayField" that match the specified "condition" within a specific document.

So whether you need to update specific fields, add or remove elements within arrays, or perform numeric operations, these operators provide a seamless and controlled way to modify your MongoDB data.


- Slide 13 -

Removing documents from collections is achieved using the `deleteOne()` and `deleteMany()` methods. These methods offer a simple approach for removing documents based on specific criteria. The `deleteOne()` method removes a single document that matches the given filter, while the `deleteMany()` method removes multiple documents that meet the specified criteria. To use these methods, you provide a filter object as a parameter to identify the documents to be deleted. It is essential to carefully consider the accuracy of the filter criteria to avoid unintended data removal. Additionally, taking regular backups and considering data archiving can help ensure data safety and preservation. After all, proper management and cautious use of these deletion methods are crucial to maintain data integrity and avoid any unintended consequences.


## Creating new documents



In this exercise, we will practice inserting new documents into our pre-excisting bookstore database. We've done this through Compass but we now want to practice on Shell. We will utilize the `insertOne()` and `insertMany()` methods to add books. The bookstore should have two main collections: "books" and "authors."

1. Design the schema for the "books" and "authors" collections.
- Each book should have fields for "title," "author," "genre," "pages," and "rating"
- Each author should have fields for "name," "nationality," and "birthdate."

2.We'll use the `insertOne()` method to add a single book and its corresponding author to the collections. For example:

```javascript
db.authors.insertOne({ 
name:"Jane Doe",
nationality:"Mexico",
birthdate:"1972-03-17" });



db.books.insertOne({
  title: "The Book Title",
  author: "Jane Doe",
  genres: [ "Mystery", "Sci-fi" ],
  pages: 274,
  rating: 10
});
```

4. We will use the `insertMany()` method to add multiple books to the "books" collection. Ensure that each book is associated with the appropriate author using their ObjectId.

```javascript

db.books.insertMany([
  {
    title: "Adventure Awaits",
    author: "Jane Doe",
    genres: ["Adventure", "Novel"  ],
    pages: 827,
    rating: 9
  },
  {
    title: "Sci-Fi Chronicles",
     author: "Jane Doe",
    genres: ["Adventure","Science Fiction"  ],
    pages: 827,
    rating: 9
  },

]);
```

5. Verify that the documents have been successfully inserted into the "books" and "authors" collections. You can use the `find()` method to retrieve and display the newly inserted documents.

```javascript
db.books.find()


db.authors.find()
```





## Retrieving and finding documents


Next, we will be practicing querying for specific books 


2. Querying arrays

```javascript
db.books.find({ genres: "Sci-fi" });
```

3. Comparison Operators:

```javascript
db.books.find({ pages: { $gt: 350 } });
```

4. Logical Operators:

```javascript
db.books.find({ $or: [{ genres: "Novel" }, { genres: "Sci-fi" }] });
```





## Sorting and limiting data in query results

Next, we'll practice using the `sort()` and `limit()` methods 


1. Sorting Results:

```javascript
db.books.find().sort({ title: 1 });



db.books.find().sort({ title: -1 });
```

2. Limiting Results:

```javascript
db.books.find().limit(3);
```

3. Combining Sorting and Limiting:

```javascript
db.books.find().sort({ rating: -1 }).limit(3);
```




## Updating documents using UPDATE operators

MongoDB provides powerful update operators that allow you to modify existing documents in MongoDB collections efficiently. Here's an introduction to some commonly used update operators:

1. $set:
   - The $set operator updates specific fields within a document or adds new fields if they don't already exist.
   - For example, `db.books.updateOne({ _id: ObjectId("64c1316cb73d272e4e403483") }, { $set: { price: 12, isbn: 263846151 } })` updates the "field1" and "field2" fields within a specific document.

2. $unset:
   - The $unset operator removes specified fields from a document.
   - For example, `db.books.updateOne({ _id: ObjectId("64c1316cb73d272e4e403483") }, { $unset: { price: 12, isbn: 263846151 } })` removes the "field1" field from a specific document.

3. $inc:
   - The $inc operator increments or decrements the value of a numeric field by a specified amount.
   - For example, `db.books.updateOne({ _id: ObjectId("64c1316cb73d272e4e403483") }, { $inc: { price: 5 } })` increments the value of the "field1" field by 1 in a specific document.

4. $push:
   - The $push operator appends elements to an array field within a document.
   - For example, `db.books.updateOne({ _id: ObjectId("64c1316cb73d272e4e403483") }, { $push: { genres: "History" } })` adds an "element" to the "arrayField" within a specific document.

5. $pull:
   - The $pull operator removes elements from an array field that match a specified condition.
   - For example, `db.books.updateOne({ _id: ObjectId("64c1316cb73d272e4e403483") }, { $pull:  { genres: "History" } })` removes elements from the "arrayField" that match the specified "condition" within a specific document.


## Deleting documents from a collection

The last thing we will practice is the use of `deleteOne()` and `deleteMany()` methods to remove documents.
Remember to practice caution when deleteing. 


1. Using deleteOne():
   - Remove a book document with the title "The Catcher in the Rye" from the collection.

```javascript
db.books.deleteOne({ title: "The Catcher in the Rye" });
```

2. Using deleteMany():
   - Remove all books published by "Penguin Books" from the collection.

```javascript
db.books.deleteMany({ author: "John Doe" });
```

## Assessment

Assessment:

1. Which method is used to insert a single document into a MongoDB collection?
   a. insertOne()
   b. insert()
   c. addOne()
   d. addDocument()

2. Which method is useful for retrieving a single document from a collection that matches a specific filter?
   a. findOne()
   b. findSingle()
   c. getOne()
   d. getSingle()

3. Which operator is used for querying documents where a field value is greater than a specified value?
   a. $gt
   b. $lt
   c. $eq
   d. $ne

4. How can you limit the number of returned documents in a MongoDB query?
   a. Using the limit() method
   b. Using the filter() method
   c. Using the sort() method
   d. Using the count() method

5. What is the purpose of the $set operator in MongoDB?
   a. Incrementing a numeric field value
   b. Removing a field from a document
   c. Updating specific fields within a document
   d. Appending elements to an array field

6. Which operator is used to append elements to an existing array in MongoDB?
   a. $push
   b. $pop
   c. $addToSet
   d. $pull

7. Which method is used to remove a single document from a MongoDB collection?
   a. deleteOne()
   b. removeOne()
   c. remove()
   d. delete()

8. How can you remove multiple documents from a MongoDB collection that match a specific criteria?
   a. deleteMany()
   b. removeMany()
   c. removeAll()
   d. delete()

9. Which operator allows you to remove specific elements from an array field in MongoDB?
   a. $pull
   b. $push
   c. $unset
   d. $inc

10. How can you access fields within nested documents in MongoDB?
    a. Using dot notation
    b. Using square brackets []
    c. Using parentheses ()
    d. Using curly braces {}

Correct answers:
1. a
2. a
3. a
4. a
5. c
6. a
7. a
8. a
9. a
10. a